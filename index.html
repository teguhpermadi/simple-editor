<html>
  <head>
    <link href="lib/mathquill.css" rel="stylesheet" />
    <link href="lib/matheditor.css" rel="stylesheet" />
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />

    <!-- include libraries(jQuery, bootstrap) -->
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!-- include summernote css/js -->
    <link
      href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
  </head>
  <body style="background: #f6f4f4; overflow: hidden">
    <style>
      button.ql-showHtml:after {
        content: "source";
      }
    </style>
    <div id="answer" style="margin-bottom: 10"></div>
    <button id="showlatex" style="margin-bottom: 10">insert latex</button>
    <!-- <div id="latex"></div> -->
    <div id="summernote">Hello Summernote</div>
    <div id="editor"></div>
  </body>

  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> -->
  <script src="lib/mathquill.min.js"></script>
  <script src="lib/matheditor.js"></script>

  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script>
    $(document).ready(function () {
      $("#summernote").summernote();
    });
  </script>
  <script type="text/javascript">
        var me = new MathEditor("answer");
        // me.removeButtons(['fraction']);
        // me.setTemplate('floating-toolbar');
        $("#showlatex").on("click", function () {
          var tex = me.getLatex();
          // $("#latex").html(tex);
          quill.focus();
          var caretPosition = quill.getSelection(true);
          quill.insertText(caretPosition, tex);

          $('#summernote').summernote('editor.saveRange');

    // Editor loses selected range (e.g after blur)

    $('#summernote').summernote('editor.restoreRange');
    $('#summernote').summernote('editor.focus');
    $('#summernote').summernote('editor.insertText', tex);
        });

        var quill = new Quill("#editor", {
          theme: "snow",
          modules: {
            toolbar: {
              container: [
                // [
                //   {
                //     font: [],
                //   },
                // ],
                // [
                //   {
                //     header: [false, 1, 2, 3, 4, 5, 6],
                //   },
                // ],
                // ["bold", "italic", "underline", "strike"],
                // [
                //   {
                //     align: [],
                //   },
                // ],
                // ["blockquote", "code-block"],
                // [
                //   {
                //     list: "ordered",
                //   },
                //   {
                //     list: "bullet",
                //   },
                //   {
                //     list: "check",
                //   },
                // ],
                // [
                //   {
                //     indent: "-1",
                //   },
                //   {
                //     indent: "+1",
                //   },
                // ],
                // [
                //   {
                //     color: [],
                //   },
                //   {
                //     background: [],
                //   },
                // ],
                // ["link", "image", "video"],
                // ["clean"],
                ["showHtml"],
              ],
              handlers: {
                showHtml: () => {
                  if (quill.txtArea.style.display === "") {
                    const html = quill.txtArea.value;
                    if (html === "<p><br/></p>") {
                      quill.html = null;
                    } else {
                      quill.html = html.replace(new RegExp("<p><br/>", "g"), "<p>");
                    }
                    quill.pasteHTML(html);
                  }
                  quill.txtArea.style.display =
                    quill.txtArea.style.display === "none" ? "" : "none";
                },
              },
            },
          },
        });

        if (Quill.prototype.getHTML == undefined)
          Quill.prototype.getHTML = function () {
            return this.container.firstChild.innerHTML;
          };

        //fix for Quill v2
        if (Quill.prototype.pasteHTML == undefined)
          Quill.prototype.pasteHTML = function (html) {
            {
              this.container.firstChild.innerHTML = html;
            }
          };

        quill.txtArea = document.createElement("textarea");
        quill.txtArea.style.cssText =
          "width: 100%;margin: 0px;background: rgb(29, 29, 29);box-sizing: border-box;color: rgb(204, 204, 204);font-size: 15px;outline: none;padding: 20px;line-height: 24px;font-family: Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;position: absolute;top: 0;bottom: 0;border: none;display:none;resize: none;";

        var htmlEditor = quill.addContainer("ql-custom");
        htmlEditor.appendChild(quill.txtArea);

        quill.on("text-change", (delta, oldDelta, source) => {
          var html = quill.getHTML();
          quill.txtArea.value = html;
        });

        quill.txtArea.value = quill.getHTML();
  </script>
</html>
